rules:
  # Security rules from Semgrep registry
  - id: javascript-express-shell-command-injection
    patterns:
      - pattern-either:
          - pattern: |
              $APP.$METHOD($REQ, ..., $FUNC(..., $REQ.params.$PARAM, ...), ...)
          - pattern: |
              $APP.$METHOD($REQ, ..., $FUNC(..., $REQ.query.$PARAM, ...), ...)
          - pattern: |
              $APP.$METHOD($REQ, ..., $FUNC(..., $REQ.body.$PARAM, ...), ...)
    message: "Possible shell command injection"
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-78: OS Command Injection"
      owasp: "A03:2021 – Injection"

  - id: javascript-sql-injection
    patterns:
      - pattern-either:
          - pattern: |
              $DB.query("... $REQ.params.$PARAM ...", ...)
          - pattern: |
              $DB.query("... $REQ.query.$PARAM ...", ...)
          - pattern: |
              $DB.query("... $REQ.body.$PARAM ...", ...)
    message: "Possible SQL injection"
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-89: SQL Injection"
      owasp: "A03:2021 – Injection"

  - id: javascript-xss
    patterns:
      - pattern-either:
          - pattern: |
              $RES.send(..., $REQ.params.$PARAM, ...)
          - pattern: |
              $RES.send(..., $REQ.query.$PARAM, ...)
          - pattern: |
              $RES.send(..., $REQ.body.$PARAM, ...)
    message: "Possible XSS vulnerability"
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      cwe: "CWE-79: Cross-site Scripting"
      owasp: "A03:2021 – Injection"

  - id: hardcoded-credentials
    patterns:
      - pattern-either:
          - pattern: |
              password = "..."
          - pattern: |
              api_key = "..."
          - pattern: |
              secret = "..."
          - pattern: |
              token = "..."
          - pattern: |
              apiKey = "..."
          - pattern: |
              apiKey = "..."
    message: "Hardcoded credential detected"
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A07:2021 – Identification and Authentication Failures"

  - id: weak-cryptography
    patterns:
      - pattern-either:
          - pattern: |
              require("md5")
          - pattern: |
              require("sha1")
    message: "Weak cryptographic algorithm detected"
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      cwe: "CWE-327: Use of a Broken or Risky Cryptographic Algorithm"
      owasp: "A02:2021 – Cryptographic Failures"

  - id: insecure-random
    patterns:
      - pattern: Math.random()
    message: "Use cryptographically secure random number generator"
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      cwe: "CWE-338: Use of Cryptographically Weak PRNG"
      owasp: "A02:2021 – Cryptographic Failures"

  - id: no-auth-check
    patterns:
      - pattern: |
          $APP.$METHOD($PATH, $HANDLER)
    message: "Express route without authentication"
    languages: [javascript, typescript]
    severity: WARNING
    metadata:
      category: security
      owasp: "A01:2021 – Broken Access Control"

  - id: eval-usage
    patterns:
      - pattern: eval(...)
    message: "Use of eval() is dangerous"
    languages: [javascript, typescript]
    severity: ERROR
    metadata:
      category: security
      cwe: "CWE-94: Improper Control of Generation of Code"
      owasp: "A03:2021 – Injection"

  - id: debug-exposure
    patterns:
      - pattern-either:
          - pattern: console.log(..., $REQ, ...)
          - pattern: console.error(..., $REQ, ...)
    message: "Potential exposure of sensitive data in logs"
    languages: [javascript, typescript]
    severity: INFO
    metadata:
      category: security
      cwe: "CWE-532: Insertion of Sensitive Information into Log File"
      owasp: "A04:2021 – Insecure Design"
