# Feature 6: Test Validation Domain Coverage Requirements

## Summary
Added comprehensive validation logic to ensure that tests meet proper domain coverage requirements when using domain filtering.

## Files Modified

### src/services/testGenerator.ts
Added new types and validation functions:

**New Types:**
- `ValidationSeverity` - Severity levels for validation messages (error, warning, info)
- `ValidationMessage` - Individual validation message with severity, message, field, and suggestion
- `DomainTestValidationResult` - Result of domain test requirements validation
- `DomainDistributionValidationResult` - Result of domain distribution validation
- `RecommendedQuestionCountResult` - Recommended question count calculation result

**New Functions:**
- `validateDomainTestRequirements(domainIds, questionCount, options)` - Validates that enough questions are available for creating a domain-specific test. Checks overall availability and per-domain availability.
- `validateDomainDistribution(domainIds, questionCount, options)` - Validates that the distribution of questions across domains matches expected weights.
- `getRecommendedQuestionCount(domainIds, options)` - Calculates the recommended question count based on available questions and domain weights.
- `validateDomainCoverage(domainIds, questionCount, options)` - Combined validation that performs all domain coverage checks at once.

### src/controllers/adminController.ts
- Updated `createTest` to include domain coverage validation:
  - Added `validateCoverage` parameter (default: true) to enable/disable validation
  - Added `strictValidation` parameter (default: false) to fail on warnings
  - Returns validation warnings in response when applicable
  - Throws error if validation fails

- Added new endpoints:
  - `validateTestCoverage` - POST /api/admin/tests/validate-coverage
    - Validates domain coverage before creating a test
    - Returns detailed validation results with messages, stats, and recommendations
  - `getTestRecommendedCount` - GET /api/admin/tests/recommended-count
    - Gets recommended question count for a domain-specific test
    - Returns minimum, maximum, and recommended counts with explanations

### src/routes/admin.ts
- Added routes for new validation endpoints:
  - POST /api/admin/tests/validate-coverage
  - GET /api/admin/tests/recommended-count

## Features

1. **Validate that enough questions exist** - Checks if there are enough questions available in the selected domains for the requested question count

2. **Warn if domain distribution doesn't match expected weights** - Validates that the distribution aligns with domain weight percentages (People 33%, Process 41%, Business Environment 26%)

3. **Suggest appropriate question counts** - Provides recommendations for minimum, maximum, and optimal question counts based on available questions

4. **Handle edge cases:**
   - No questions available for a domain
   - Insufficient questions for requested count
   - Invalid domain IDs
   - Empty domain selection for domain-specific test

5. **Helpful but non-blocking validation** - Provides warnings and recommendations rather than hard failures where appropriate

## Validation Behavior

- **Errors** (block test creation): Invalid domain IDs, no questions available, insufficient questions
- **Warnings** (allow but notify): Domain cannot meet target count, low question count, distribution deviation
- **Info** (informational only): Distribution weights, all requirements met

## Usage Examples

```typescript
// Validate before creating a test
const validation = await validateDomainCoverage(
  ['people-domain-id'],
  50
);
if (!validation.overallValid) {
  // Handle validation errors
}

// Get recommended count
const recommendation = await getRecommendedQuestionCount(['people-domain-id']);
console.log(`Recommended: ${recommendation.recommended} questions`);

// Create test with validation (validation enabled by default)
POST /api/admin/tests
{
  "name": "People Domain Test",
  "domainIds": ["people-domain-id"],
  "questionIds": [...],
  "validateCoverage": true,  // default
  "strictValidation": false  // default
}
```
